<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>APEPE - Pharaoh's Portal v31</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS BASE --- */
        :root { 
            --gold: #FFD700; --gold-dim: #b8860b; --bg: #050505; --green: #00ff41; --gray: #888; --alert: #ffcc00; --red: #ff3333; --admin: #ff0000; --cyan: #00ffff;
        }

        body { 
            background-color: var(--bg); 
            background-image: radial-gradient(circle at center, #1a1a00 0%, #000000 100%);
            color: var(--gold); 
            font-family: 'Rajdhani', sans-serif; text-align: center; margin: 0; padding: 20px; padding-bottom: 80px; min-height: 100vh;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }

        h2, h3 { font-family: 'Cinzel', serif; letter-spacing: 2px; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
        h2 { font-size: 2em; margin-bottom: 5px; color: #fff; text-shadow: 0 0 10px var(--gold); }

        .container { 
            max-width: 480px; margin: auto; border: 1px solid var(--gold-dim); padding: 25px; border-radius: 20px; 
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px); 
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(255, 215, 0, 0.05);
            animation: fadeIn 1s ease-out;
            position: relative;
        }
        @keyframes fadeIn { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

        .header-box { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; justify-content: center; align-items: center; background: transparent; }
        .header-img { max-width: 100%; height: auto; display: block; border-radius: 12px; filter: drop-shadow(0 0 10px rgba(255,215,0,0.3)); margin-bottom: 10px; }
        .pc-header-controls { width: 100%; }

        /* SOCIAL LINKS */
        .social-box-mobile { display: flex; flex-direction: column; gap: 8px; margin: 10px 0; width: 100%; }
        .social-box-pc { display: none; }
        .social-link { 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            color: #ccc; text-decoration: none; font-size: 0.9em; padding: 8px;
            background: rgba(255,255,255,0.05); border-radius: 6px; border: 1px solid #333; transition: 0.3s;
        }
        .social-link:hover { border-color: var(--gold); color: var(--gold); background: rgba(255,215,0,0.1); }

        button { border: none; padding: 16px; font-weight: 700; cursor: pointer; border-radius: 8px; margin: 12px 0; width: 100%; text-transform: uppercase; transition: 0.3s; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px; font-size: 1.1em; }
        .btn-gold { background: linear-gradient(45deg, var(--gold-dim), var(--gold)); color: #000; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5); }
        .btn-green { background: linear-gradient(45deg, #004d00, #00cc00); color: #fff; box-shadow: 0 4px 15px rgba(0, 255, 0, 0.2); }
        .btn-green:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(0, 255, 0, 0.4); }
        .btn-red { background: linear-gradient(45deg, #8B0000, #FF0000); color: #fff; box-shadow: 0 4px 15px rgba(255, 0, 0, 0.2); border: 1px solid #ff3333; }
        .btn-red:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(255, 0, 0, 0.4); }
        .btn-white { background: rgba(255,255,255,0.1); border: 1px solid #555; color: #ccc; }
        .btn-white:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: #fff; }
        .btn-disabled { background: #222 !important; color: #555 !important; border: 1px solid #333 !important; cursor: not-allowed !important; }

        .card { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 25px; padding-top: 20px; position: relative; }
        input { width: 100%; padding: 15px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.5); color: #fff; text-align: center; font-size: 1.4em; margin: 10px 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; transition: 0.3s; }
        input:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .highlight { color: var(--green); font-weight: bold; text-shadow: 0 0 5px rgba(0,255,0,0.5); }
        .hidden { display: none !important; }
        .small-txt { font-size: 0.85em; color: #aaa; letter-spacing: 0.5px; }
        .error-txt { font-size: 0.9em; color: var(--red); font-weight: bold; margin-top: 5px; display: none; text-transform: uppercase; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-box { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 10px; border: 1px solid #333; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.3s; }
        .stat-box:hover { border-color: var(--gold-dim); box-shadow: inset 0 0 10px rgba(255,215,0,0.05); }
        .stat-label { font-size: 0.7em; color: #888; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .stat-val { font-size: 1.2em; font-weight: 700; color: #fff; }

        .admin-panel { border: 2px solid var(--admin); background: rgba(50, 0, 0, 0.5); padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none; }
        
        .btn-admin { 
            background: var(--admin); color: #fff; font-size: 0.8em; margin: 5px 0; 
            transition: all 0.2s ease-in-out; cursor: pointer; border: 1px solid #500; 
            position: relative; z-index: 10; 
        }
        .btn-admin:hover { 
            background: #ff0000 !important; border-color: #fff !important;
            transform: scale(1.05); box-shadow: 0 0 15px rgba(255, 0, 0, 0.8) !important; 
        }
        
        .warning-box { background: rgba(255, 204, 0, 0.05); border: 1px solid var(--alert); color: var(--alert); padding: 10px; font-size: 0.8em; border-radius: 8px; margin-top: 15px; }
        .balance-info { display: flex; justify-content: space-between; font-size: 0.9em; width: 100%; margin: 5px auto 0; color: #ccc; }
        .live-dot { height: 8px; width: 8px; background-color: #444; border-radius: 50%; display: inline-block; margin-left: 5px; }
        .live-on { background-color: #00ff00; box-shadow: 0 0 5px #00ff00; }
        .status-msg { font-size: 0.85em; color: var(--green); margin: 10px 0; font-weight: bold; line-height: 1.4; text-shadow: 0 0 5px rgba(0, 255, 0, 0.3); }
        .extra-links { display: flex; gap: 10px; justify-content: center; margin-top: 30px; margin-bottom: 20px; }
        .btn-small { font-size: 0.8em; padding: 10px 15px; width: auto; border: 1px solid var(--gold-dim); background: rgba(0,0,0,0.5); color: #ccc; }
        .btn-small:hover { border-color: var(--gold); color: var(--gold); background: rgba(255,215,0,0.1); }
        .security-blue-box { display:none; background: rgba(0, 255, 255, 0.05); border: 1px solid var(--cyan); padding: 12px; margin: 15px 0; border-radius: 12px; font-size: 0.85em; color: var(--cyan); text-shadow: 0 0 5px rgba(0, 255, 255, 0.4); box-shadow: 0 0 10px rgba(0, 255, 255, 0.1); }
    
        .progress-container { 
            width: 100%; background-color: #000; border-radius: 12px; 
            margin: 15px 0; border: 2px solid #333; height: 28px; 
            position: relative; overflow: hidden; 
        }
        .progress-bar { 
            height: 100%; background: linear-gradient(90deg, #b8860b, #FFD700, #00ff41); 
            width: 0%; transition: width 0.8s ease-in-out; border-radius: 10px 0 0 10px; 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); 
        }
        .progress-text { position: absolute; width: 100%; text-align: center; top: 4px; font-size: 0.9em; color: #fff; font-weight: bold; text-shadow: 1px 1px 3px #000; z-index: 2; letter-spacing: 1px;}
        .supply-info { margin-top: -10px; margin-bottom: 20px; font-size: 0.85em; color: #666; }
        .supply-gold { color: var(--gold); font-weight: bold; }

        .feed-container { text-align: left; margin-top: 15px; padding-right: 5px; min-height: 200px; max-height: 300px; overflow-y: auto; }
        .feed-item { padding: 10px 0; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; animation: fadeIn 0.5s ease-out; }
        .feed-wallet { color: var(--gold); font-weight: bold; font-family: 'Rajdhani', sans-serif; }
        .feed-amounts { text-align: right; line-height: 1.2; }
        .pagination-ctrl { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
        .page-btn { background: transparent; border: 1px solid #444; color: #888; padding: 5px 10px; font-size: 0.75em; cursor: pointer; border-radius: 4px; }
        .page-btn:hover { border-color: var(--gold); color: var(--gold); }

        #price-alert { display: none; background: rgba(255, 0, 0, 0.1); border: 1px dashed var(--red); padding: 10px; border-radius: 8px; margin: 15px 0; text-align: center; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 51, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0); } }

        /* Estilo para el mensaje de advertencia rojo peque√±o */
        .red-warning-small {
            font-size: 0.7em;
            color: var(--red);
            text-shadow: 0 0 3px rgba(255,0,0,0.5);
            margin-top: 5px;
            font-style: italic;
            display: none; /* Oculto por defecto */
        }

        /* --- LANDING VIEW --- */
        #landing-view {
            height: 100vh; width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box; background: radial-gradient(circle at center, #1a1a00 0%, #000000 90%); z-index: 9999;
        }
        .landing-logo { max-width: 180px; height: auto; margin-bottom: 20px; filter: drop-shadow(0 0 25px rgba(255,215,0,0.6)); animation: float 6s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .landing-title { font-size: 3em; color: var(--gold); text-shadow: 0 0 20px var(--gold-dim); margin: 0; }
        .landing-subtitle { color: #fff; letter-spacing: 3px; font-size: 0.9em; margin-bottom: 40px; opacity: 0.7; }
        .btn-hero { max-width: 300px; padding: 20px; font-size: 1.3em; background: linear-gradient(45deg, #FFD700, #FFA500); box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); color: #000; border: 1px solid #fff; }
        .btn-hero:hover { transform: scale(1.05); box-shadow: 0 0 50px rgba(255, 215, 0, 0.7); }
        .landing-socials { display: flex; gap: 20px; margin-bottom: 30px; }
        .landing-social-link { color: #ccc; text-decoration: none; font-size: 1.1em; padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid #333; border-radius: 30px; transition: 0.3s; }
        .landing-social-link:hover { border-color: var(--gold); color: var(--gold); background: rgba(255,215,0,0.1); transform: translateY(-3px); }

        /* ========================================= */
        /* === PC DESKTOP MODE (FIX ALINEACI√ìN) === */
        /* ========================================= */
        @media (min-width: 1024px) {
            body:not(.mobile-mode) #dashboard-view {
                display: flex; align-items: flex-start; justify-content: center; padding: 40px 0;
            }

            body:not(.mobile-mode) .container {
                max-width: 1400px; width: 98%; height: auto;
                display: grid; 
                grid-template-columns: 350px 1fr 350px; 
                gap: 40px; padding: 30px; overflow: visible; 
                background: transparent; box-shadow: none; border: none; backdrop-filter: none;
                align-items: start; 
            }

            body:not(.mobile-mode) .header-box {
                grid-column: 1 / -1; display: grid; grid-template-columns: 1fr auto 1fr; 
                align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,215,0,0.2); padding-bottom: 15px;
                grid-row: 1;
            }
            body:not(.mobile-mode) .header-box::before { content: ""; display: block; }

            body:not(.mobile-mode) .header-info-wrapper { display: flex; justify-content: center; align-items: center; }
            body:not(.mobile-mode) .header-img { max-width: 60px; margin-bottom: 0; margin-right: 20px; }
            body:not(.mobile-mode) h2 { margin: 0; font-size: 2em; text-align: left; }

            body:not(.mobile-mode) .pc-header-controls { width: auto; display: flex; gap: 15px; align-items: center; justify-content: flex-end; }
            body:not(.mobile-mode) #connectBtn { width: auto; margin: 0; padding: 10px 25px; font-size: 0.9em; }
            body:not(.mobile-mode) #addTokenBtn { width: auto; margin: 0; display: inline-block; }
            body:not(.mobile-mode) #walletAddress { position: absolute; top: 95px; right: 30px; text-align: right; }

            /* FIX 3: FORZAR FILA 2 PARA TODOS LOS PANELES */
            body:not(.mobile-mode) .panel-left { grid-column: 1 / 2; grid-row: 2; }
            body:not(.mobile-mode) .panel-center { grid-column: 2 / 3; grid-row: 2; min-width: 0; }
            body:not(.mobile-mode) .panel-right { grid-column: 3 / 4; grid-row: 2; }

            /* Estilo Cards PC */
            body:not(.mobile-mode) .card, body:not(.mobile-mode) .panel-left > div {
                margin-top: 0; margin-bottom: 20px; 
                background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px);
                padding: 20px; border-radius: 15px; border: 1px solid var(--gold-dim);
                box-shadow: 0 0 20px rgba(0,0,0,0.5);
            }
            body:not(.mobile-mode) .feed-container { max-height: 300px; }
            body:not(.mobile-mode) .social-box-mobile { display: none; }
            body:not(.mobile-mode) .social-box-pc { display: flex; flex-direction: column; gap: 10px; margin-top: 20px;}
        }
    </style>
</head>
<body>

<div id="landing-view">
    <img src="https://i.ibb.co/DPb1Xm4c/unnamed.jpg" alt="Ancient Pepe" class="landing-logo">
    <h1 class="landing-title">ANCIENT PEPE</h1>
    <p class="landing-subtitle">OFFICIAL IMPERIAL PORTAL</p>

    <div class="landing-socials">
        <a href="https://x.com/Ancientsatpepe" target="_blank" class="landing-social-link">‚úñÔ∏è @Ancientsatpepe</a>
        <a href="https://x.com/prlxchain" target="_blank" class="landing-social-link">‚úñÔ∏è @prlxchain</a>
    </div>

    <button id="landingConnectBtn" class="btn-hero" onclick="connect()">
        CONNECT METAMASK ü¶ä
    </button>
    <button id="addTokenBtnLanding" class="btn-white" style="max-width: 300px; margin-top: 20px; border-radius: 30px;">‚ûï Add $APEPE</button>
</div>

<div id="dashboard-view" class="hidden">
    <div class="container">
        <div class="header-box">
            <div class="header-info-wrapper">
                <img src="https://i.ibb.co/DPb1Xm4c/unnamed.jpg" alt="Ancient Pepe" class="header-img">
                <div>
                    <h2>ANCIENT PEPE üè∫</h2>
                    <p class="small-txt" style="margin:0; text-align: left;">OFFICIAL IMPERIAL PORTAL</p>
                </div>
            </div>
            
            <div class="social-box-mobile">
                <a href="https://x.com/Ancientsatpepe" target="_blank" class="social-link">‚úñÔ∏è @Ancientsatpepe</a>
                <a href="https://x.com/prlxchain" target="_blank" class="social-link">‚úñÔ∏è @prlxchain</a>
            </div>

            <div class="pc-header-controls">
                <button id="connectBtn" class="btn-green">CONNECTED ‚úÖ</button>
                <button id="addTokenBtn" class="btn-white" style="font-size: 0.75em; padding: 10px;">‚ûï Add $APEPE</button>
            </div>
        </div>
        
        <div id="walletAddress" class="small-txt" style="margin-top: 5px; margin-bottom:15px;">Reading Wallet...</div>

        <div class="panel-center">
            <div class="card">
                <h3>üöÄ EXCLUSIVE PRE-SALE</h3>
                <div id="buy-section">
                    <div class="balance-info">
                        <span>Wallet Balance:</span>
                        <span class="highlight"><span id="userLaxBal">0.00</span> $LAX</span>
                    </div>
                    <input type="number" id="laxInput" placeholder="Min: 1 $LAX">
                    <p id="minError" class="error-txt">‚ö†Ô∏è MINIMUM 1 LAX TO BUY</p>
                    
                    <div id="price-alert">
                        <p class="small-txt" style="margin:0; color: #aaa;">CURRENT PRICE PHASE:</p>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 5px;">
                            <div style="text-decoration: line-through; color: #666; font-size: 0.9em;">1 LAX = 20 APEPE</div>
                            <div style="color: #fff;">‚ûù</div>
                            <div class="highlight" style="font-size: 1.1em; color: var(--green);">1 LAX = <span id="currentRateDisplay">20</span> APEPE</div>
                        </div>
                        <div style="background: var(--red); color: white; font-size: 0.7em; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; font-weight: bold;">
                            üìà PRICE INCREASED <span id="percentIncrease">0</span>%
                        </div>
                    </div>

                    <div style="display:flex; justify-content:space-between; margin-top:10px;">
                        <span class="small-txt">Recieve:</span>
                        <span class="small-txt">Cost:</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-size: 1.1em; font-weight:bold;">
                        <span class="highlight"><span id="aspPreview">0</span> $APEPE</span>
                        <span style="color:#fff;"><span id="usdCost">0.00</span> USD</span>
                    </div>
                    <button id="buyBtn" class="btn-green" style="margin-top: 20px;">PURCHASE $APEPE NOW</button>
                    <p id="buy-warning" class="red-warning-small">Confirmation depends on block confirmation on the network, which can take up to 30 minutes in the worst case.</p>
                </div>
                <div id="pre-loading" class="hidden">
                    <button class="btn-disabled">PROCESSING... ‚è≥</button>
                    <p class="status-msg">Confirming on blockchain...<br>Please wait.</p>
                    <p class="red-warning-small" style="display:block;">Confirmation depends on block confirmation on the network, which can take up to 30 minutes in the worst case.</p>
                </div>
            </div>
            
            <div class="social-box-pc">
                <a href="https://x.com/Ancientsatpepe" target="_blank" class="social-link">‚úñÔ∏è @Ancientsatpepe</a>
                <a href="https://x.com/prlxchain" target="_blank" class="social-link">‚úñÔ∏è @prlxchain</a>
            </div>

            <div class="extra-links" style="margin-top: 15px;">
                <button onclick="window.location.href='lore.html'" class="btn-small">üìú LORE</button>
                <button onclick="window.location.href='tokenomics.html'" class="btn-small">üìä TOKENS</button>
            </div>
        </div>

        <div class="panel-left">
            <div id="adminPanel" class="admin-panel">
                <h3 style="color:var(--admin); margin-top:0;">üëë PHARAOH COMMAND</h3>
                <p class="small-txt">Authorized Access Only</p>
                <button id="adminWithdrawBtn" class="btn-admin">üí∞ RETIRAR FONDOS (LAX)</button>
                <button id="adminStartDexBtn" class="btn-admin">üöÄ ENABLE DEX & VESTING</button>
                
                <hr style="border-color: #500; margin: 10px 0;">
                
                <p class="small-txt" style="color:#f88;">‚öôÔ∏è CHANGE RATE (APEPE/LAX)</p>
                <div style="display:flex; gap:10px; justify-content:center; align-items:center;">
                    <input type="number" id="newRateInput" placeholder="Ex: 20" style="font-size:0.9em; padding:8px; width: 60%;">
                    <button id="setRateBtn" class="btn-admin" style="width: auto; padding: 8px 15px;">SET RATE</button>
                </div>
            </div>

            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
                <div id="progressText" class="progress-text">0.00% SOLD</div>
            </div>
            
            <div class="supply-info">
                TOTAL SUPPLY: <span class="supply-gold">21,000,000 APEPE</span><br>
                (3M en Preventa | 50% Liquidez Bloqueada)
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-label">$LAX RAISED</span>
                    <span id="laxRaised" class="stat-val">Loading...</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">APEPE SOLD</span>
                    <span id="tokensSold" class="stat-val">Loading...</span>
                </div>
            </div>

            <div class="card" style="padding-bottom: 15px;">
                <h3 style="margin-bottom:5px;">
                    üìú RECENT ACTIVITY 
                    <a href="https://explorer.parallaxprotocol.org/address/0x241D981d656808b30f2cC83242a307B6EF0A5e4f?tab=token_transfers" target="_blank" style="font-size:0.5em; vertical-align:middle; text-decoration:none; margin-left:5px;" class="btn-white">üîó View Explorer</a>
                </h3>
                <div id="liveFeedList" class="feed-container small-txt">
                    <p style="text-align:center; opacity: 0.6; padding-top:20px;">Scanning blockchain... ‚è≥</p>
                </div>
                <div id="pagination" class="pagination-ctrl hidden">
                    <button id="prevPageBtn" class="page-btn" onclick="changePage(-1)">‚óÄ</button>
                    <span id="pageIndicator" class="small-txt" style="align-self:center;">P1</span>
                    <button id="nextPageBtn" class="page-btn" onclick="changePage(1)">‚ñ∂</button>
                </div>
            </div>
        </div>

        <div class="panel-right">
            <div class="card">
                <h3>üîí ANCIENT VAULT (V4)</h3>
                <p class="small-txt">APY: <span id="dynamicAPY" class="highlight" style="color:cyan;">WAITING FOR LAUNCH...</span></p>
                
                <div id="blue-security-msg" class="security-blue-box" style="display:block;">
                    üõ°Ô∏è <b>SECURITY ACTIVE:</b> Early pool protection enabled.<br>Rewards are normalized to prevent draining.
                </div>
                
                <div style="background: rgba(255, 215, 0, 0.05); border: 1px solid #444; padding: 10px; border-radius: 8px; margin: 15px 0;">
                    <span class="stat-label">TOTAL POOL STAKED</span><br>
                    <span id="totalStakedDisplay" style="font-size: 1.3em; font-weight: bold; color: var(--gold-dim);">Loading...</span>
                </div>
                
                <div style="background: rgba(0, 50, 0, 0.4); border: 1px solid var(--green); padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <span class="stat-label">YOU HAVE STAKED</span><br>
                    <span id="myStakedAmt" style="font-size: 1.6em; font-weight: bold; color: #fff; text-shadow: 0 0 10px rgba(0,255,0,0.5);">0.0000</span> <span class="highlight">$APEPE</span>
                </div>

                <div style="background: rgba(60, 50, 0, 0.4); border: 1px solid var(--gold); padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <span class="stat-label">LIVE REWARDS <span class="live-dot live-on"></span></span><br>
                    <span id="myRewardsBig" style="font-size: 1.6em; font-weight: bold; color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.5);">0.0000</span> $APEPE
                </div>

                <div style="margin: 15px 0; border: 1px dashed #444; padding: 8px; border-radius: 8px;">
                    <span class="stat-label">DEX STATUS</span><br>
                    <span id="dexStatus" class="highlight" style="color: cyan; font-size:0.9em;">WAITING FOR LAUNCH...</span>
                </div>

                <div id="stk-step1">
                    <p class="small-txt">Enable $APEPE to start staking.</p>
                    <button id="stk-approveBtn" class="btn-white">ENABLE $APEPE</button>
                    <p id="warn-enable" class="red-warning-small">Confirmation depends on block confirmation on the network, which can take up to 30 minutes in the worst case.</p>
                </div>
                <div id="stk-loading" class="hidden">
                    <button class="btn-disabled">PROCESSING... ‚è≥</button>
                    <p class="status-msg">Confirming on blockchain...</p>
                    <p class="red-warning-small" style="display:block;">Confirmation depends on block confirmation on the network, which can take up to 30 minutes in the worst case.</p>
                </div>
                <div id="stk-step2" class="hidden">
                    <p class="highlight" style="margin-bottom:5px;">$APEPE ENABLED! ‚úÖ</p>
                    <div class="balance-info">
                        <span>Available to Stake:</span>
                        <span class="highlight"><span id="userAspBal">0.00</span> $APEPE</span>
                    </div>
                    <input type="number" id="stakeInput" placeholder="Amount of $APEPE">
                    <button id="stakeBtn" class="btn-green">STAKE $APEPE</button>
                    
                    <button id="unstakeBtn" class="btn-red" style="margin-top:15px; border-color:#555; background: #222;">üîì UNSTAKE & EXIT</button>
                    <p id="unstake-msg" class="small-txt" style="margin-top:5px; font-size:0.7em;">*You can always withdraw your principal.</p>
                    
                    <div class="warning-box">
                        ‚ö†Ô∏è <b>IMPORTANT:</b> Rewards are vested for <b>6 MONTHS</b> after DEX Launch. 
                        <br>Exit early = <b>LOSE REWARDS</b>.
                        <br>Compound = <b>KEEP REWARDS</b>.
                    </div>
                </div>
                
                <div id="restake-ui">
                    <button id="restakeBtn" class="btn-disabled" style="margin-top:20px; font-size: 0.9em;" disabled>‚ôªÔ∏è NO REWARDS TO COMPOUND</button>
                    <button id="claimBtn" class="btn-disabled" style="margin-top:10px; font-size: 0.9em;" disabled>üîí CLAIM LOCKED (VESTING)</button>
                </div>

                <div id="restake-loading" class="hidden" style="margin-top:20px;">
                    <button class="btn-disabled">PROCESSING... ‚è≥</button>
                    <p class="status-msg">Confirming on blockchain...</p>
                    <p class="red-warning-small" style="display:block;">Confirmation depends on block confirmation on the network, which can take up to 30 minutes in the worst case.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- METAMASK APP & MOBILE DETECTION ---
    (function() {
        const userAgent = navigator.userAgent.toLowerCase();
        const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
        if (window.ethereum && window.ethereum.isMetaMask && isMobile) {
            document.body.classList.add('mobile-mode');
        } else if (isMobile) {
            document.body.classList.add('mobile-mode');
        }
    })();

    // --- CONTRACT ADDRESSES ---
    const PRESALE_ADDR = "0x241D981d656808b30f2cC83242a307B6EF0A5e4f"; // V3
    const STAKE_ADDR   = "0x45a117ABe265623239a3c7A050EA7e8D7b040248"; // V3 FIXED
    const APEPE_ADDR   = "0xd1060183552A88455f037a58B2aC639C7966a214"; // Token
    
    // --- CONFIGURACI√ìN API & OWNER ---
    const INITIAL_SUPPLY = 3000000; 
    const OWNER_ADDRESS = "0x57DB4E4B824937d641D05Cd355027e85E2Fb4958"; 
    const NONKYC_KEY = "384f9ffc81ab61bcd0d43d69fbf6517f"; // READ-ONLY KEY
    
    let laxPriceUsd = 0.07; // Default fallback
    let currentExchangeRate = 20; 
    let allFeedLogs = []; 
    let currentPage = 1;
    const itemsPerPage = 5;

    // --- ABI COMPLETO ---
    const ABI = [
        "event TokensPurchased(address indexed buyer, uint256 nativeAmount, uint256 tokenAmount)",
        "function buyTokens() public payable",
        "function withdrawNativeFunds() external",
        "function stake(uint256 _amount) external", 
        "function compound() external",
        "function withdraw(uint256 _amount) external",
        "function getReward() public",
        "function enableDex() external",
        "function isSafetyModeActive() external view returns (bool)", 
        "function dexReady() public view returns (bool)",
        "function isPenaltyActive() public view returns (bool)",
        "function earned(address account) public view returns (uint256)",
        "function balanceOf(address account) external view returns (uint256)", 
        "function approve(address s, uint256 a) public returns (bool)",
        "function allowance(address o, address s) public view returns (uint256)",
        "function rate() public view returns (uint256)",
        "function setRate(uint256 _newRate) external",
        "function rewardRate() view returns (uint256)",
        "function totalSupply() view returns (uint256)"
    ];

    let signer, provider;

    window.onload = async function() {
        if(window.ethereum) {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (accounts.length > 0) {
                connect();
            }
        }
        handleBuyInput("");
        fetchLivePrice(); // Auto fetch on load
        setInterval(fetchLivePrice, 60000); // Auto fetch every 60s
    };

    function unlockDashboard() {
        document.getElementById('landing-view').classList.add('hidden');
        document.getElementById('dashboard-view').classList.remove('hidden');
    }

    async function connect() {
        if (!window.ethereum) return;
        try {
            const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
            unlockDashboard();
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            document.getElementById('walletAddress').innerText = "Wallet: " + accs[0].substring(0,6) + "..." + accs[0].substring(38);
            if(accs[0].toLowerCase() === OWNER_ADDRESS.toLowerCase()) document.getElementById('adminPanel').style.display = 'block';
            checkStakingAllowance(accs[0]);
            loadData();
            loadRecentBuys();
            provider.on("block", (blockNumber) => { loadData(); if(blockNumber % 3 === 0) loadRecentBuys(); });
        } catch (e) { console.error(e); }
    }

    async function ensureNetwork() {
        try {
            const net = await provider.getNetwork();
            if (net.chainId !== 2110 && net.chainId !== 0x83E) {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x83E', chainName: 'Parallax Mainnet',
                        nativeCurrency: { name: 'LAX', symbol: 'LAX', decimals: 18 },
                        rpcUrls: ['https://rpc.parallaxchain.org'],
                        blockExplorerUrls: ['https://explorer.parallaxchain.org']
                    }],
                });
            }
        } catch(e) { console.error(e); }
    }

    // --- AUTO PRICE FETCH (NONKYC) ---
    async function fetchLivePrice() {
        try {
            // Using public ticker endpoint (usually doesn't require key, but key variable is ready if needed in headers)
            // Endpoint for LAX/USDT ticker
            const response = await fetch('https://api.nonkyc.io/api/v2/ticker/LAX_USDT');
            const data = await response.json();
            if (data && data.last_price) {
                laxPriceUsd = parseFloat(data.last_price);
                // Update UI instantly
                handleBuyInput(document.getElementById('laxInput').value);
            }
        } catch (e) {
            console.log("Auto-price fetch failed, keeping default:", e);
        }
    }

    function handleBuyInput(valStr) {
        const val = parseFloat(valStr);
        const buyBtn = document.getElementById('buyBtn');
        const warnMsg = document.getElementById('buy-warning');
        
        document.getElementById('aspPreview').innerText = (val > 0) ? (val * currentExchangeRate).toLocaleString() : "0";
        document.getElementById('usdCost').innerText = (val > 0) ? (val * laxPriceUsd).toFixed(4) : "0.00"; // More decimals for precision
        if (!val || val < 0.01) { 
            if(valStr !== "") document.getElementById('minError').style.display = 'block';
            buyBtn.disabled = true; buyBtn.classList.add('btn-disabled');
            if(warnMsg) warnMsg.style.display = 'none';
        } else {
            document.getElementById('minError').style.display = 'none';
            buyBtn.disabled = false; buyBtn.classList.remove('btn-disabled');
        }
    }
    document.getElementById('laxInput').oninput = (e) => handleBuyInput(e.target.value);

    document.getElementById('buyBtn').onclick = async () => {
        const amt = document.getElementById('laxInput').value;
        const warnMsg = document.getElementById('buy-warning');
        if(warnMsg) warnMsg.style.display = 'block';

        try {
            await ensureNetwork();
            const wei = ethers.utils.parseUnits(amt.toString(), 18);
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, signer);
            const tx = await preC.buyTokens({ value: wei, gasLimit: 200000 });
            document.getElementById('buy-section').classList.add('hidden');
            document.getElementById('pre-loading').classList.remove('hidden');
            await tx.wait();
            alert("SUCCESS! üè∫ $APEPE Purchased.");
            window.location.reload();
        } catch(e) { 
            console.error(e); alert("Transaction failed."); 
            document.getElementById('pre-loading').classList.add('hidden'); 
            document.getElementById('buy-section').classList.remove('hidden'); 
            if(warnMsg) warnMsg.style.display = 'none';
        }
    };

    // --- ADMIN ACTIONS ---
    document.getElementById('adminWithdrawBtn').onclick = async () => {
        try { if(!confirm("‚ö†Ô∏è SECURITY CHECK\n\nWithdraw ALL LAX from contract to your wallet?")) return; await ensureNetwork(); const preC = new ethers.Contract(PRESALE_ADDR, ABI, signer); const tx = await preC.withdrawNativeFunds(); await tx.wait(); alert("FUNDS WITHDRAWN! üí∞"); } catch(e) { alert("Error: " + e.message); }
    };
    document.getElementById('adminStartDexBtn').onclick = async () => {
        try { if(!confirm("‚ö†Ô∏è LAUNCH WARNING\n\nAre you sure you want to ENABLE DEX & START VESTING?\nThis cannot be undone.")) return; await ensureNetwork(); const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer); const tx = await stkC.enableDex(); await tx.wait(); alert("DEX ENABLED! üöÄ"); loadData(); } catch(e) { alert("Error: " + e.message); }
    };
    document.getElementById('setRateBtn').onclick = async () => {
        const newRate = document.getElementById('newRateInput').value;
        if(!newRate || newRate <= 0) return alert("Please enter a valid rate.");
        try {
            if(!confirm(`‚ö†Ô∏è CHANGE PRICE CHECK\n\nSet New Rate to: 1 LAX = ${newRate} APEPE?`)) return;
            await ensureNetwork();
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, signer);
            const tx = await preC.setRate(newRate);
            await tx.wait();
            alert(`PRICE UPDATED TO ${newRate}! üìà`);
            loadData();
        } catch(e) { alert("Error: " + e.message); }
    };

    // --- STAKING ---
    async function checkStakingAllowance(user) { try { const aspC = new ethers.Contract(APEPE_ADDR, ABI, provider); const allow = await aspC.allowance(user, STAKE_ADDR); if(allow.gt(ethers.utils.parseEther("1000"))) showStep('stk', 2); } catch(e) { console.error(e); } }
    
    function showStep(type, step) {
        if(step === 2) {
             document.getElementById('stk-step1').classList.add('hidden');
             document.getElementById('stk-loading').classList.add('hidden');
             document.getElementById('stk-step2').classList.remove('hidden');
        } else if (step === 'loading') {
             document.getElementById('stk-step1').classList.add('hidden');
             document.getElementById('stk-step2').classList.add('hidden');
             document.getElementById('stk-loading').classList.remove('hidden');
             const warn = document.getElementById('warn-enable');
             if(warn) warn.style.display = 'block';
        } else {
             document.getElementById('stk-step1').classList.remove('hidden');
             document.getElementById('stk-loading').classList.add('hidden');
             document.getElementById('stk-step2').classList.add('hidden');
        }
    }

    document.getElementById('stk-approveBtn').onclick = async () => { 
        const warn = document.getElementById('warn-enable');
        if(warn) warn.style.display = 'block';
        try { await ensureNetwork(); const aspC = new ethers.Contract(APEPE_ADDR, ABI, signer); const tx = await aspC.approve(STAKE_ADDR, ethers.constants.MaxUint256); showStep('stk', 'loading'); await tx.wait(); showStep('stk', 2); } catch(e) { showStep('stk', 1); } 
    };
    document.getElementById('stakeBtn').onclick = async () => { const amt = document.getElementById('stakeInput').value; if (!amt || amt <= 0) return; try { await ensureNetwork(); const wei = ethers.utils.parseUnits(amt.toString(), 18); const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer); const tx = await stkC.stake(wei, { gasLimit: 500000 }); showStep('stk', 'loading'); await tx.wait(); setTimeout(() => loadData(), 3000); alert("STAKING SUCCESSFUL! üîí"); window.location.reload(); } catch(e) { alert("Staking failed."); showStep('stk', 2); } };
    document.getElementById('unstakeBtn').onclick = async () => { try { await ensureNetwork(); const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer); const user = await signer.getAddress(); const bal = await stkC.balanceOf(user); let warningMsg = "Withdraw your Principal?"; try { const isPenalty = await stkC.isPenaltyActive(); if(isPenalty) warningMsg = "‚ö†Ô∏è WARNING: You are withdrawing BEFORE vesting ends.\n\nYou will receive your PRINCIPAL, but ALL REWARDS will be FORFEITED (Lost).\n\nAre you sure?"; } catch(e) {} if(bal.eq(0)) { alert("No stake to withdraw."); return; } if(!confirm(warningMsg)) return; const tx = await stkC.withdraw(bal, { gasLimit: 500000 }); await tx.wait(); setTimeout(() => loadData(), 3000); alert("PRINCIPAL WITHDRAWN! üîì"); window.location.reload(); } catch(e) { alert("Error: " + e.message); } };
    document.getElementById('restakeBtn').onclick = async () => { try { await ensureNetwork(); document.getElementById('restake-ui').classList.add('hidden'); document.getElementById('restake-loading').classList.remove('hidden'); const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer); const tx = await stkC.compound({ gasLimit: 500000 }); await tx.wait(); setTimeout(() => loadData(), 3000); alert("Compound Successful! ‚ôªÔ∏è"); window.location.reload(); } catch(e) { alert("Compound failed (Min 20 APEPE required)."); document.getElementById('restake-loading').classList.add('hidden'); document.getElementById('restake-ui').classList.remove('hidden'); } };
    document.getElementById('claimBtn').onclick = async () => { try { await ensureNetwork(); document.getElementById('restake-ui').classList.add('hidden'); document.getElementById('restake-loading').classList.remove('hidden'); const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer); const tx = await stkC.getReward({ gasLimit: 500000 }); await tx.wait(); setTimeout(() => loadData(), 3000); alert("Rewards Claimed! üí∞"); window.location.reload(); } catch(e) { alert("Claim failed or Locked."); document.getElementById('restake-loading').classList.add('hidden'); document.getElementById('restake-ui').classList.remove('hidden'); } };

    async function loadData() {
        try {
            const user = await signer.getAddress();
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, provider);
            
            try {
                const rateBn = await preC.rate();
                currentExchangeRate = rateBn.toNumber();
                if (currentExchangeRate < 20) {
                    document.getElementById('price-alert').style.display = 'block';
                    document.getElementById('currentRateDisplay').innerText = currentExchangeRate;
                    let increase = ((20 - currentExchangeRate) / currentExchangeRate) * 100;
                    document.getElementById('percentIncrease').innerText = "+" + increase.toFixed(0);
                } else {
                    document.getElementById('price-alert').style.display = 'none';
                }
                handleBuyInput(document.getElementById('laxInput').value);
            } catch(e) {}

            const rawLax = await provider.getBalance(user);
            document.getElementById('userLaxBal').innerText = parseFloat(ethers.utils.formatEther(rawLax)).toFixed(4);
            
            const aspC = new ethers.Contract(APEPE_ADDR, ABI, provider);
            const contractAspBal = await aspC.balanceOf(PRESALE_ADDR);
            const left = parseFloat(ethers.utils.formatEther(contractAspBal));
            const effectiveTotal = Math.max(INITIAL_SUPPLY, left);
            
            // FIX BARRA DE VENTA:
            let sold = INITIAL_SUPPLY - left;
            if (sold < 0) sold = 0; 
            let laxRaised = sold / 20; 

            document.getElementById('laxRaised').innerText = laxRaised.toLocaleString(undefined, {maximumFractionDigits:2});
            document.getElementById('tokensSold').innerText = sold.toLocaleString(undefined, {maximumFractionDigits:0});

            let percent = (sold / effectiveTotal) * 100;
            let displayPercent = percent.toFixed(2);
            if (sold > 0 && percent < 0.01) displayPercent = "< 0.01";
            document.getElementById('progressBar').style.width = Math.max(percent, 1) + "%"; 
            document.getElementById('progressText').innerText = displayPercent + "% SOLD";

            const rawAsp = await aspC.balanceOf(user);
            document.getElementById('userAspBal').innerText = parseFloat(ethers.utils.formatEther(rawAsp)).toFixed(4);
            
            const stkC = new ethers.Contract(STAKE_ADDR, ABI, provider);
            
            // --- TOTAL STAKED ---
            try {
                const totalStakedBn = await stkC.totalSupply();
                const totalStakedVal = parseFloat(ethers.utils.formatEther(totalStakedBn));
                document.getElementById('totalStakedDisplay').innerText = totalStakedVal.toLocaleString(undefined, {maximumFractionDigits: 0}) + " APEPE";
            } catch(e) {
                document.getElementById('totalStakedDisplay').innerText = "0 APEPE";
            }

            // --- ESTADO DEX Y APY ---
            let isLaunched = false;
            try { isLaunched = await stkC.dexReady(); } catch(e) {}

            const statusEl = document.getElementById('dexStatus');
            const apyEl = document.getElementById('dynamicAPY');
            const blueMsg = document.getElementById('blue-security-msg');

            if(!isLaunched) { 
                statusEl.innerText = "WAITING FOR LAUNCH..."; 
                statusEl.style.color = "cyan";
                blueMsg.style.display = 'block';
                apyEl.innerText = "WAITING FOR LAUNCH...";
                apyEl.style.color = "cyan";
            } else { 
                statusEl.innerText = "LIVE! REWARDS GENERATING ‚ö°"; 
                statusEl.style.color = "#00ff00";
                blueMsg.style.display = 'none';
                try {
                    const rRate = await stkC.rewardRate();
                    const tSupply = await stkC.totalSupply();
                    const rRateNum = parseFloat(ethers.utils.formatEther(rRate));
                    const tSupplyNum = parseFloat(ethers.utils.formatEther(tSupply));
                    if (tSupplyNum > 0 && rRateNum > 0) {
                        const yearlyRewards = rRateNum * 31536000;
                        const apy = (yearlyRewards / tSupplyNum) * 100;
                        apyEl.innerText = apy.toLocaleString(undefined, {maximumFractionDigits: 0}) + "% APY";
                        apyEl.style.color = "#00ff00";
                    } else {
                        apyEl.innerText = "DYNAMIC HIGH YIELD";
                    }
                } catch(e) { apyEl.innerText = "DYNAMIC HIGH YIELD"; }
            }

            const rew = await stkC.earned(user);
            const rewVal = parseFloat(ethers.utils.formatUnits(rew, 18));
            document.getElementById('myRewardsBig').innerText = rewVal.toFixed(4);

            const restakeBtn = document.getElementById('restakeBtn');
            if(rewVal >= 20) { restakeBtn.disabled = false; restakeBtn.classList.remove('btn-disabled'); restakeBtn.classList.add('btn-green'); restakeBtn.innerText = "‚ôªÔ∏è COMPOUND REWARDS (RESTAKE)"; } else { restakeBtn.disabled = true; restakeBtn.classList.add('btn-disabled'); restakeBtn.classList.remove('btn-green'); restakeBtn.innerText = "‚ôªÔ∏è COMPOUND (MIN 20 APEPE)"; }

            const claimBtn = document.getElementById('claimBtn'); const unstakeBtn = document.getElementById('unstakeBtn'); const unstakeMsg = document.getElementById('unstake-msg');
            try { const isPenalty = await stkC.isPenaltyActive(); if(isPenalty) { claimBtn.disabled = true; claimBtn.classList.add('btn-disabled'); claimBtn.classList.remove('btn-gold'); claimBtn.innerText = "üîí CLAIM LOCKED (VESTING)"; unstakeBtn.innerText = "‚ö†Ô∏è UNSTAKE (YOU LOSE REWARDS)"; unstakeMsg.innerText = "*Early exit forfeits ALL profits."; } else { if(rewVal > 0) { claimBtn.disabled = false; claimBtn.classList.remove('btn-disabled'); claimBtn.classList.add('btn-gold'); claimBtn.innerText = "üí∞ CLAIM REWARDS TO WALLET"; } else { claimBtn.innerText = "üí∞ CLAIM (NO REWARDS)"; } unstakeBtn.innerText = "üîì UNSTAKE PRINCIPAL"; unstakeMsg.innerText = "*You can withdraw safely."; } } catch(e) {}

            const stakedBal = await stkC.balanceOf(user);
            const stakedAmount = parseFloat(ethers.utils.formatEther(stakedBal));
            document.getElementById('myStakedAmt').innerText = stakedAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4});

        } catch(e) { console.error(e); }
    }

    document.getElementById('addTokenBtn').onclick = async () => { await window.ethereum.request({ method: 'wallet_watchAsset', params: { type: 'ERC20', options: { address: APEPE_ADDR, symbol: 'APEPE', decimals: 18 } }, }); };
    document.getElementById('addTokenBtnLanding').onclick = async () => { await window.ethereum.request({ method: 'wallet_watchAsset', params: { type: 'ERC20', options: { address: APEPE_ADDR, symbol: 'APEPE', decimals: 18 } }, }); };
    document.getElementById('connectBtn').onclick = connect;
    
    // Cargar feed en segundo plano
    async function loadRecentBuys() {
        try {
            if (!provider) return; 
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, provider);
            const feedDiv = document.getElementById('liveFeedList');
            feedDiv.innerHTML = "<p style='text-align:center; opacity:0.6;'>Scanning blockchain (Deep Scan)... ‚è≥</p>";
            
            const latestBlock = await provider.getBlockNumber();
            const BLOCK_RANGE = 50000; 
            const fromBlock = Math.max(0, latestBlock - BLOCK_RANGE);
            const filter = preC.filters.TokensPurchased();
            const logs = await preC.queryFilter(filter, fromBlock, latestBlock);

            if (logs.length === 0) {
                feedDiv.innerHTML = "<p style='text-align:center; opacity:0.6;'>No recent activity detected.</p>";
                document.getElementById('pagination').classList.add('hidden');
                return;
            }

            allFeedLogs = logs.reverse();
            currentPage = 1;
            renderPage(currentPage);
            document.getElementById('pagination').classList.remove('hidden');

        } catch (e) { console.error("Feed Error:", e); document.getElementById('liveFeedList').innerHTML = "<p style='text-align:center; color:var(--red); opacity:0.7;'>Feed unavailable</p>"; }
    }

    function renderPage(page) {
        const feedDiv = document.getElementById('liveFeedList');
        feedDiv.innerHTML = "";
        
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageLogs = allFeedLogs.slice(start, end);

        pageLogs.forEach(log => {
            const buyer = log.args.buyer;
            const shortBuyer = buyer.substring(0, 6) + "..." + buyer.substring(38);
            const laxAmt = parseFloat(ethers.utils.formatEther(log.args.nativeAmount)).toFixed(2);
            const apepeAmt = parseFloat(ethers.utils.formatEther(log.args.tokenAmount)).toLocaleString(undefined, {maximumFractionDigits: 0});
            const itemHtml = `
                <div class="feed-item">
                    <div><span style="font-size:1.2em;">üê∏</span> Wallet <span class="feed-wallet">${shortBuyer}</span><span class="small-txt"><br>bought</span></div>
                    <div class="feed-amounts"><span class="highlight">${apepeAmt} APEPE</span><br><span class="small-txt">for ${laxAmt} LAX</span></div>
                </div>`;
            feedDiv.innerHTML += itemHtml;
        });

        document.getElementById('pageIndicator').innerText = `Page ${page}`;
        document.getElementById('prevPageBtn').disabled = (page === 1);
        document.getElementById('nextPageBtn').disabled = (end >= allFeedLogs.length);
    }

    window.changePage = function(direction) { currentPage += direction; renderPage(currentPage); }
</script>
</body>
</html>

