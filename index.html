<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEPE - Pharaoh's Portal v9.1 Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS VISUALES --- */
        :root { 
            --gold: #FFD700; --gold-dim: #b8860b; --bg: #050505; --green: #00ff41; --gray: #888; --alert: #ffcc00; --red: #ff3333; --admin: #ff0000;
        }

        body { 
            background-color: var(--bg); 
            background-image: radial-gradient(circle at center, #1a1a00 0%, #000000 100%);
            color: var(--gold); 
            font-family: 'Rajdhani', sans-serif; text-align: center; margin: 0; padding: 20px; padding-bottom: 80px; min-height: 100vh;
        }

        h2, h3 { font-family: 'Cinzel', serif; letter-spacing: 2px; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
        h2 { font-size: 2em; margin-bottom: 5px; color: #fff; text-shadow: 0 0 10px var(--gold); }

        .container { 
            max-width: 480px; margin: auto; border: 1px solid var(--gold-dim); padding: 25px; border-radius: 20px; 
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px); 
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(255, 215, 0, 0.05);
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

        /* CABECERA CORREGIDA (Rectangular) */
        .header-box { width: 100%; margin-bottom: 25px; display: flex; justify-content: center; align-items: center; background: transparent; }
        .header-img { max-width: 100%; height: auto; display: block; transition: transform 0.5s; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); /* Eliminado border-radius y border */ }
        .header-img:hover { transform: scale(1.02); }
        
        button { 
            border: none; padding: 16px; font-weight: 700; cursor: pointer; border-radius: 8px; margin: 12px 0; width: 100%; 
            text-transform: uppercase; transition: 0.3s; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px; font-size: 1.1em;
        }
        
        .btn-gold { background: linear-gradient(45deg, var(--gold-dim), var(--gold)); color: #000; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5); }

        .btn-green { background: linear-gradient(45deg, #004d00, #00cc00); color: #fff; box-shadow: 0 4px 15px rgba(0, 255, 0, 0.2); }
        .btn-green:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(0, 255, 0, 0.4); }

        .btn-red { background: linear-gradient(45deg, #8B0000, #FF0000); color: #fff; box-shadow: 0 4px 15px rgba(255, 0, 0, 0.2); border: 1px solid #ff3333; }
        .btn-red:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(255, 0, 0, 0.4); }

        .btn-white { background: rgba(255,255,255,0.1); border: 1px solid #555; color: #ccc; }
        .btn-white:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: #fff; }

        .btn-disabled { background: #222 !important; color: #555 !important; border: 1px solid #333 !important; cursor: not-allowed !important; transform: none !important; box-shadow: none !important; }
        
        .card { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 25px; padding-top: 20px; position: relative; }
        
        input { 
            width: 100%; padding: 15px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.5); 
            color: #fff; text-align: center; font-size: 1.4em; margin: 10px 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; transition: 0.3s;
        }
        input:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        
        .highlight { color: var(--green); font-weight: bold; text-shadow: 0 0 5px rgba(0,255,0,0.5); }
        .hidden { display: none; }
        .small-txt { font-size: 0.85em; color: #aaa; letter-spacing: 0.5px; }
        .error-txt { font-size: 0.9em; color: var(--red); font-weight: bold; margin-top: 5px; display: none; text-transform: uppercase; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-box { 
            background: rgba(0,0,0,0.4); padding: 12px; border-radius: 10px; border: 1px solid #333; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; transition: 0.3s;
        }
        .stat-box:hover { border-color: var(--gold-dim); box-shadow: inset 0 0 10px rgba(255,215,0,0.05); }
        
        .stat-label { font-size: 0.7em; color: #888; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .stat-val { font-size: 1.2em; font-weight: 700; color: #fff; }

        .admin-panel { border: 2px solid var(--admin); background: rgba(50, 0, 0, 0.5); padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none; }
        .btn-admin { background: var(--admin); color: #fff; font-size: 0.8em; margin: 5px 0; }
        
        .footer { margin-top: 40px; border-top: 1px solid #222; padding-top: 20px; }
        .social-links a { color: #666; text-decoration: none; margin: 0 15px; font-size: 1.1em; transition: 0.3s; display: inline-block; }
        .social-links a:hover { color: var(--gold); text-shadow: 0 0 10px var(--gold); transform: scale(1.1); }

        .warning-box { background: rgba(255, 204, 0, 0.05); border: 1px solid var(--alert); color: var(--alert); padding: 10px; font-size: 0.8em; border-radius: 8px; margin-top: 15px; }
        .balance-info { display: flex; justify-content: space-between; font-size: 0.9em; width: 100%; margin: 5px auto 0; color: #ccc; }
        
        .live-dot { height: 8px; width: 8px; background-color: #444; border-radius: 50%; display: inline-block; margin-left: 5px; }
        .live-on { background-color: #00ff00; box-shadow: 0 0 5px #00ff00; }
        
        .status-msg { font-size: 0.85em; color: var(--green); margin: 10px 0; font-weight: bold; line-height: 1.4; text-shadow: 0 0 5px rgba(0, 255, 0, 0.3); }

        .extra-links { display: flex; gap: 10px; justify-content: center; margin-top: 30px; margin-bottom: 20px; }
        .btn-small { font-size: 0.8em; padding: 10px 15px; width: auto; border: 1px solid var(--gold-dim); background: rgba(0,0,0,0.5); color: #ccc; }
        .btn-small:hover { border-color: var(--gold); color: var(--gold); background: rgba(255,215,0,0.1); }

        /* --- SEGURIDAD ANTI-BALLENA --- */
        #security-warning { display:none; background: rgba(0, 255, 255, 0.05); border: 1px solid cyan; padding: 10px; margin-top: 10px; border-radius: 8px; font-size: 0.8em; color: cyan; text-shadow: 0 0 5px cyan; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <img src="https://i.ibb.co/0VMjVWjS/1000042544.jpg" alt="Ancient Satoshi Pepe" class="header-img">
    </div>
    
    <h2>ANCIENT SATOSHI PEPE üè∫</h2>
    <p class="small-txt">OFFICIAL IMPERIAL PORTAL</p>
    
    <button id="connectBtn" class="btn-gold">Connect MetaMask ü¶ä</button>
    <button id="addNetworkBtn" class="btn-white" style="font-size: 0.75em; margin-top: 0; padding: 10px;">Add Parallax Network ‚õìÔ∏è</button>
    <div id="walletAddress" class="small-txt" style="margin-top: 10px;">Not Connected</div>

    <div id="adminPanel" class="admin-panel">
        <h3 style="color:var(--admin); margin-top:0;">üëë PHARAOH COMMAND</h3>
        <p class="small-txt">Authorized Access Only</p>
        <button id="adminWithdrawBtn" class="btn-admin">üí∞ RETIRAR FONDOS (LAX)</button>
        <button id="adminStartDexBtn" class="btn-admin">üöÄ ENABLE DEX & VESTING</button>
    </div>

    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-label">Tokens Left</span>
            <span id="tokensLeft" class="stat-val">Loading...</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">Tokens Sold</span>
            <span id="tokensSold" class="stat-val">Loading...</span>
        </div>
    </div>

    <div class="card">
        <h3>üöÄ EXCLUSIVE PRE-SALE</h3>
        
        <div id="buy-section">
            <div class="balance-info">
                <span>Wallet Balance:</span>
                <span class="highlight"><span id="userLaxBal">0.00</span> $LAX</span>
            </div>
            
            <input type="number" id="laxInput" placeholder="Min: 1 $LAX">
            <p id="minError" class="error-txt">‚ö†Ô∏è MINIMUM 1 LAX TO BUY</p>
            
            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <span class="small-txt">Recieve:</span>
                <span class="small-txt">Cost:</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size: 1.1em; font-weight:bold;">
                <span class="highlight"><span id="aspPreview">0</span> $APEPE</span>
                <span style="color:#fff;"><span id="usdCost">0.00</span> USD</span>
            </div>

            <button id="buyBtn" class="btn-green" style="margin-top: 20px;">PURCHASE $APEPE NOW</button>
        </div>
        
        <div id="pre-loading" class="hidden">
            <button class="btn-disabled">PROCESSING... ‚è≥</button>
            <p class="status-msg">Confirming on blockchain...<br>This process can take up to 30 minutes.<br>Please do not close this window.</p>
        </div>
    </div>

    <div class="card">
        <h3>üîí ANCIENT VAULT (V4)</h3>
        <p class="small-txt">APY: <span id="dynamicAPY" class="highlight">DYNAMIC HIGH YIELD</span></p>
        
        <div id="security-warning">
            üõ°Ô∏è <b>SECURITY ACTIVE:</b> Early pool protection enabled.<br>Rewards are normalized to prevent draining.
        </div>
        
        <div style="background: rgba(0, 50, 0, 0.4); border: 1px solid var(--green); padding: 15px; border-radius: 12px; margin: 15px 0;">
            <span class="stat-label">YOU HAVE STAKED</span><br>
            <span id="myStakedAmt" style="font-size: 1.6em; font-weight: bold; color: #fff; text-shadow: 0 0 10px rgba(0,255,0,0.5);">0.0000</span> <span class="highlight">$APEPE</span>
        </div>

        <div style="background: rgba(60, 50, 0, 0.4); border: 1px solid var(--gold); padding: 15px; border-radius: 12px; margin: 15px 0;">
            <span class="stat-label">LIVE REWARDS <span class="live-dot live-on"></span></span><br>
            <span id="myRewardsBig" style="font-size: 1.6em; font-weight: bold; color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.5);">0.0000</span> $APEPE
        </div>

        <div style="margin: 15px 0; border: 1px dashed #444; padding: 8px; border-radius: 8px;">
            <span class="stat-label">DEX STATUS</span><br>
            <span id="dexStatus" class="highlight" style="color: cyan; font-size:0.9em;">WAITING FOR LAUNCH...</span>
        </div>

        <div id="stk-step1">
            <p class="small-txt">Enable $APEPE to start staking.</p>
            <button id="stk-approveBtn" class="btn-white">ENABLE $APEPE</button>
        </div>
        <div id="stk-loading" class="hidden">
            <button class="btn-disabled">PROCESSING... ‚è≥</button>
            <p class="status-msg">Confirming on blockchain...</p>
        </div>
        <div id="stk-step2" class="hidden">
            <p class="highlight" style="margin-bottom:5px;">$APEPE ENABLED! ‚úÖ</p>
            <div class="balance-info">
                <span>Available to Stake:</span>
                <span class="highlight"><span id="userAspBal">0.00</span> $APEPE</span>
            </div>
            <input type="number" id="stakeInput" placeholder="Amount of $APEPE">
            <button id="stakeBtn" class="btn-green">STAKE $APEPE</button>
            
            <button id="unstakeBtn" class="btn-red" style="margin-top:15px; border-color:#555; background: #222;">üîì UNSTAKE PRINCIPAL (Keep Rewards)</button>
            <p class="small-txt" style="margin-top:5px; font-size:0.7em;">*You can always withdraw your principal.</p>
            
            <div class="warning-box">
                ‚ö†Ô∏è <b>IMPORTANT:</b> Rewards are vesting for <b>6 MONTHS</b> after DEX Launch. You can compound freely.
            </div>
        </div>
        
        <div id="restake-ui">
            <button id="restakeBtn" class="btn-disabled" style="margin-top:20px; font-size: 0.9em;" disabled>‚ôªÔ∏è NO REWARDS TO COMPOUND</button>
        </div>
        <div id="restake-loading" class="hidden" style="margin-top:20px;">
            <button class="btn-disabled">PROCESSING... ‚è≥</button>
            <p class="status-msg">Confirming on blockchain...<br>This process can take up to 30 minutes.</p>
        </div>

        <button id="addTokenBtn" class="btn-white" style="margin-top:10px; font-size: 0.7em; padding: 8px;">‚ûï Add $APEPE to MetaMask</button>
    </div>
    
    <div class="extra-links">
        <button onclick="window.location.href='lore.html'" class="btn-small">üìú READ LORE</button>
        <button onclick="window.location.href='tokenomics.html'" class="btn-small">üìä TOKENOMICS</button>
    </div>

    <div class="footer">
        <div class="social-links">
            <a href="https://x.com/Ancientsatpepe" target="_blank">‚úñÔ∏è Ancient Satoshi Pepe</a>
            <a href="https://x.com/prlxchain" target="_blank">‚úñÔ∏è @prlxchain</a>
        </div>
        <p class="small-txt" style="margin-top: 15px; opacity: 0.5;">¬© 2025 Ancient Satoshi Pepe</p>
    </div>
</div>

<script>
    // --- UPDATED CONTRACT ADDRESSES (LAS DEFINITIVAS) ---
    const PRESALE_ADDR = "0x241D981d656808b30f2cC83242a307B6EF0A5e4f"; // V3 Presale
    const STAKE_ADDR   = "0xE18866b3a9359F6cf19e3cDF2dF610cBBA14eb29"; // V4 Vault
    const APEPE_ADDR   = "0xd1060183552A88455f037a58B2aC639C7966a214"; // Token
    
    const INITIAL_SUPPLY = 3150000; 
    // PON TU WALLET AQU√ç PARA VER EL PANEL DE ADMIN
    const OWNER_ADDRESS = "0x57DB4E4B824937d641D05Cd355027e85E2Fb4958"; 
    
    let laxPriceUsd = 0.07; 

    // --- ABI ACTUALIZADO (Funciones V3 y V4) ---
    const ABI = [
        // Presale V3
        "function buyTokens() public payable",
        "function withdrawNativeFunds() external",
        // Vault V4
        "function stake(uint256 _amount) external", 
        "function compound() external",
        "function withdraw(uint256 _amount) external",
        "function getReward() public",
        "function enableDex() external",
        "function isSafetyModeActive() external view returns (bool)", // Funci√≥n de la imagen
        "function dexReady() public view returns (bool)",
        "function earned(address account) public view returns (uint256)",
        "function balanceOf(address account) external view returns (uint256)", 
        // ERC20
        "function approve(address s, uint256 a) public returns (bool)",
        "function allowance(address o, address s) public view returns (uint256)"
    ];

    let signer, provider;

    window.onload = async function() {
        if(window.ethereum) {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (accounts.length > 0) connect();
        }
        handleBuyInput("");
    };

    async function connect() {
        if (!window.ethereum) return;
        try {
            const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            document.getElementById('connectBtn').innerText = "CONNECTED ‚úÖ";
            document.getElementById('connectBtn').classList.add('btn-green');
            document.getElementById('walletAddress').innerText = "Wallet: " + accs[0].substring(0,6) + "..." + accs[0].substring(38);
            
            if(accs[0].toLowerCase() === OWNER_ADDRESS.toLowerCase()) {
                document.getElementById('adminPanel').style.display = 'block';
            }

            checkStakingAllowance(accs[0]);
            loadData();
            
            provider.on("block", (blockNumber) => { loadData(); });

        } catch (e) { console.error(e); }
    }

    function handleBuyInput(valStr) {
        const val = parseFloat(valStr);
        const buyBtn = document.getElementById('buyBtn');
        // Rate: 1 LAX = 20 APEPE
        document.getElementById('aspPreview').innerText = (val > 0) ? (val * 20).toLocaleString() : "0";
        document.getElementById('usdCost').innerText = (val > 0) ? (val * laxPriceUsd).toFixed(2) : "0.00";

        if (!val || val < 0.01) { // Min 0.01 LAX
            if(valStr !== "") document.getElementById('minError').style.display = 'block';
            buyBtn.disabled = true; buyBtn.classList.add('btn-disabled');
        } else {
            document.getElementById('minError').style.display = 'none';
            buyBtn.disabled = false; buyBtn.classList.remove('btn-disabled');
        }
    }

    document.getElementById('laxInput').oninput = (e) => handleBuyInput(e.target.value);

    // --- COMPRAR (PRESALE V3) ---
    document.getElementById('buyBtn').onclick = async () => {
        const amt = document.getElementById('laxInput').value;
        try {
            const wei = ethers.utils.parseUnits(amt.toString(), 18);
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, signer);
            // V3 usa buyTokens() con msg.value
            const tx = await preC.buyTokens({ value: wei, gasLimit: 200000 });
            document.getElementById('buy-section').classList.add('hidden');
            document.getElementById('pre-loading').classList.remove('hidden');
            await tx.wait();
            alert("SUCCESS! üè∫ $APEPE Purchased.");
            window.location.reload();
        } catch(e) { 
            console.error(e);
            alert("Transaction failed."); 
            document.getElementById('pre-loading').classList.add('hidden');
            document.getElementById('buy-section').classList.remove('hidden');
        }
    };

    // --- FUNCIONES ADMIN ---
    document.getElementById('adminWithdrawBtn').onclick = async () => {
        try {
            if(!confirm("Withdraw ALL LAX?")) return;
            const preC = new ethers.Contract(PRESALE_ADDR, ABI, signer);
            const tx = await preC.withdrawNativeFunds();
            await tx.wait();
            alert("FUNDS WITHDRAWN! üí∞");
        } catch(e) { alert("Error: " + e.message); }
    };
    document.getElementById('adminStartDexBtn').onclick = async () => {
        try {
            if(!confirm("ENABLE DEX & START VESTING?")) return;
            const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer);
            const tx = await stkC.enableDex();
            await tx.wait();
            alert("DEX ENABLED! üöÄ");
            loadData();
        } catch(e) { alert("Error: " + e.message); }
    };

    // --- STAKING LOGIC ---
    async function checkStakingAllowance(user) {
        try {
            const aspC = new ethers.Contract(APEPE_ADDR, ABI, provider);
            const allow = await aspC.allowance(user, STAKE_ADDR);
            if(allow.gt(ethers.utils.parseEther("1000"))) showStep('stk', 2);
        } catch(e) { console.error(e); }
    }
    document.getElementById('stk-approveBtn').onclick = async () => {
        try {
            const aspC = new ethers.Contract(APEPE_ADDR, ABI, signer);
            const tx = await aspC.approve(STAKE_ADDR, ethers.constants.MaxUint256);
            showStep('stk', 'loading');
            await tx.wait();
            showStep('stk', 2);
        } catch(e) { showStep('stk', 1); }
    };
    
    document.getElementById('stakeBtn').onclick = async () => {
        const amt = document.getElementById('stakeInput').value;
        if (!amt || amt <= 0) return;
        try {
            const wei = ethers.utils.parseUnits(amt.toString(), 18);
            const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer);
            const tx = await stkC.stake(wei, { gasLimit: 500000 });
            showStep('stk', 'loading'); 
            await tx.wait();
            alert("STAKING SUCCESSFUL! üîí");
            window.location.reload();
        } catch(e) { alert("Staking failed."); showStep('stk', 2); }
    };
    
    document.getElementById('unstakeBtn').onclick = async () => {
        try {
            // Retirar solo principal
            const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer);
            const user = await signer.getAddress();
            const bal = await stkC.balanceOf(user); // Balance staked
            
            if(bal.eq(0)) { alert("No stake to withdraw."); return; }
            
            if(!confirm("Withdraw your Principal? Rewards will remain if vested.")) return;
            
            const tx = await stkC.withdraw(bal, { gasLimit: 500000 });
            await tx.wait();
            alert("PRINCIPAL WITHDRAWN! üîì");
            window.location.reload();
        } catch(e) { alert("Error: " + e.message); }
    };

    document.getElementById('restakeBtn').onclick = async () => {
        try {
            document.getElementById('restake-ui').classList.add('hidden');
            document.getElementById('restake-loading').classList.remove('hidden');

            const stkC = new ethers.Contract(STAKE_ADDR, ABI, signer);
            // V4 usa compound()
            const tx = await stkC.compound({ gasLimit: 500000 });
            await tx.wait();
            
            alert("Compound Successful!");
            window.location.reload();
        } catch(e) { 
            alert("Compound failed."); 
            document.getElementById('restake-loading').classList.add('hidden');
            document.getElementById('restake-ui').classList.remove('hidden');
        }
    };

    async function loadData() {
        try {
            const user = await signer.getAddress();
            const rawLax = await provider.getBalance(user);
            document.getElementById('userLaxBal').innerText = parseFloat(ethers.utils.formatEther(rawLax)).toFixed(4);
            
            const aspC = new ethers.Contract(APEPE_ADDR, ABI, provider);
            // L√≥gica Presale
            const contractAspBal = await aspC.balanceOf(PRESALE_ADDR);
            const left = parseFloat(ethers.utils.formatEther(contractAspBal));
            document.getElementById('tokensLeft').innerText = left.toLocaleString(undefined, {maximumFractionDigits:0});
            document.getElementById('tokensSold').innerText = Math.max(0, INITIAL_SUPPLY - left).toLocaleString();

            const rawAsp = await aspC.balanceOf(user);
            document.getElementById('userAspBal').innerText = parseFloat(ethers.utils.formatEther(rawAsp)).toFixed(4);
            
            // Vault V4 Data
            const stkC = new ethers.Contract(STAKE_ADDR, ABI, provider);
            
            // --- L√ìGICA DE SEGURIDAD ---
            try {
                const isSafety = await stkC.isSafetyModeActive();
                if(isSafety) document.getElementById('security-warning').style.display = 'block';
                else document.getElementById('security-warning').style.display = 'none';
            } catch(e) {}

            // Rewards
            const rew = await stkC.earned(user);
            const rewVal = parseFloat(ethers.utils.formatUnits(rew, 18));
            document.getElementById('myRewardsBig').innerText = rewVal.toFixed(4);

            const restakeBtn = document.getElementById('restakeBtn');
            if(rewVal >= 1) {
                restakeBtn.disabled = false;
                restakeBtn.classList.remove('btn-disabled');
                restakeBtn.classList.add('btn-green');
                restakeBtn.innerText = "‚ôªÔ∏è COMPOUND REWARDS (RESTAKE)";
            } else {
                restakeBtn.disabled = true;
                restakeBtn.classList.add('btn-disabled');
                restakeBtn.classList.remove('btn-green');
                restakeBtn.innerText = "‚ôªÔ∏è REWARDS TOO LOW";
            }

            // Staked Amount
            const stakedBal = await stkC.balanceOf(user);
            const stakedAmount = parseFloat(ethers.utils.formatEther(stakedBal));
            document.getElementById('myStakedAmt').innerText = stakedAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4});

            const statusEl = document.getElementById('dexStatus');
            try {
                const isLaunched = await stkC.dexReady();
                if(!isLaunched) {
                    statusEl.innerText = "WAITING FOR LAUNCH...";
                    statusEl.style.color = "cyan";
                } else {
                    statusEl.innerText = "LIVE! COUNTDOWN ACTIVE ‚è≥";
                    statusEl.style.color = "#00ff00"; 
                }
            } catch(e) {}

        } catch(e) { console.error(e); }
    }

    function showStep(type, step) {
        document.getElementById(`${type}-step1`).classList.add('hidden');
        document.getElementById(`${type}-loading`).classList.add('hidden');
        document.getElementById(`${type}-step2`).classList.add('hidden');
        document.getElementById(`${type}-${step === 1 ? 'step1' : step === 'loading' ? 'loading' : 'step2'}`).classList.remove('hidden');
    }

    document.getElementById('addNetworkBtn').onclick = async () => {
        await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{ chainId: '0x83E', chainName: 'Parallax Mainnet', nativeCurrency: { name: 'LAX', symbol: 'LAX', decimals: 18 }, rpcUrls: ['https://rpc.parallaxchain.org'], blockExplorerUrls: ['https://explorer.parallaxchain.org'] }]
        });
    };
    document.getElementById('addTokenBtn').onclick = async () => {
        await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: { type: 'ERC20', options: { address: APEPE_ADDR, symbol: 'APEPE', decimals: 18 } },
        });
    };
    document.getElementById('connectBtn').onclick = connect;
</script>
</body>
</html>
